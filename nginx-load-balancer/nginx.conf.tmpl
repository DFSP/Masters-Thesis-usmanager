load_module "modules/ngx_http_geoip2_module.so";

user root;
worker_processes auto;

error_log /dev/stdout info;
pid /var/run/nginx.pid;

events {
  worker_connections 1024;
}

http {
	geoip2 /usr/share/GeoIP/GeoLite2-City.mmdb {
		$geoip2_location_latitude location latitude;
		$geoip2_location_longitude location longitude;
    }

	access_log /dev/stdout;

	server {
		listen 80;
		server_name load-balancer.com;

		include /etc/nginx/conf.d/*.conf;

    	location /_/nginx-load-balancer-api {
			resolver 127.0.0.11 valid=30s;
      		proxy_connect_timeout 100;
      		proxy_read_timeout 100;

      		auth_basic "Restricted";
      		auth_basic_user_file /etc/nginx/.htpasswd;

      		proxy_pass http://localhost:1906;

      		proxy_set_header X-Forwarded-Host $host;
      		proxy_set_header Authorization "";
      		proxy_redirect off;
    	}

  }
}
